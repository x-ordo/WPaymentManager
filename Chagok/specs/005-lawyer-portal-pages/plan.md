# Implementation Plan: Lawyer Portal Pages

**Branch**: `005-lawyer-portal-pages` | **Date**: 2025-12-08 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/005-lawyer-portal-pages/spec.md`

## Summary

Fix 404 errors on existing lawyer portal pages and implement missing pages:
- **P1**: Verify/fix routing for existing pages (`/lawyer/cases`, `/lawyer/calendar`, `/lawyer/messages`, `/lawyer/billing`)
- **P2**: Implement `/lawyer/clients` and `/lawyer/investigators` pages with backend APIs
- **P3**: Implement `/settings` hub page and `/cases` role-based redirect

**Root Cause**: Empty directories exist for `/lawyer/clients`, `/lawyer/investigators`, and `/settings` without `page.tsx` files, causing 404 errors. The middleware routing is working correctly.

## Technical Context

**Language/Version**: Python 3.11 (Backend), TypeScript 5.x (Frontend)
**Primary Dependencies**: FastAPI 0.104+, Next.js 14, SQLAlchemy, React
**Storage**: PostgreSQL (RDS), existing `users`, `cases`, `case_members` tables
**Testing**: pytest (backend), Jest + React Testing Library (frontend)
**Target Platform**: Web (Chrome, Safari, Firefox), Mobile-responsive (375px+)
**Project Type**: Web application (frontend + backend)
**Performance Goals**: Page load <2s for lists up to 100 items
**Constraints**: Must follow existing design patterns, no new database tables for core functionality
**Scale/Scope**: ~50 clients/lawyer, ~10 investigators/lawyer, standard user settings

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Notes |
|-----------|--------|-------|
| I. Evidence Integrity | N/A | No evidence handling in this feature |
| II. Case Isolation | PASS | Client/investigator queries scoped to lawyer's cases only |
| III. No Auto-Submit | N/A | No AI generation in this feature |
| IV. AWS-Only Storage | PASS | No new storage, uses existing PostgreSQL |
| V. Clean Architecture | PASS | Following Routers → Services → Repositories pattern |
| VI. Branch Protection | PASS | Working on feature branch `005-lawyer-portal-pages` |
| VII. TDD Cycle | PASS | Tests will be written before implementation |

## Project Structure

### Documentation (this feature)

```text
specs/005-lawyer-portal-pages/
├── plan.md              # This file
├── spec.md              # Feature requirements
├── research.md          # Phase 0 findings
├── data-model.md        # Entity definitions
├── quickstart.md        # Rapid onboarding guide
├── contracts/           # API contracts
│   ├── clients-api.json
│   ├── client-detail-api.json
│   ├── investigators-api.json
│   ├── investigator-detail-api.json
│   └── settings-api.json
└── tasks.md             # Phase 2 output (generated by /speckit.tasks)
```

### Source Code (repository root)

```text
backend/
├── app/
│   ├── api/
│   │   ├── lawyer_portal.py      # Existing (has merge conflict to fix)
│   │   ├── lawyer_clients.py     # NEW: Client list/detail endpoints
│   │   ├── lawyer_investigators.py # NEW: Investigator list/detail
│   │   └── settings.py           # NEW: User settings endpoints
│   ├── services/
│   │   ├── client_list_service.py      # NEW
│   │   ├── investigator_list_service.py # NEW
│   │   └── settings_service.py         # NEW
│   ├── schemas/
│   │   ├── client_list.py        # NEW
│   │   ├── investigator_list.py  # NEW
│   │   └── settings.py           # NEW
│   └── repositories/
│       └── (uses existing case_repository.py)
└── tests/
    ├── test_api/
    │   ├── test_lawyer_clients.py     # NEW
    │   ├── test_lawyer_investigators.py # NEW
    │   └── test_settings.py           # NEW
    └── test_services/
        ├── test_client_list_service.py # NEW
        └── test_investigator_list_service.py # NEW

frontend/
├── src/
│   ├── app/
│   │   ├── lawyer/
│   │   │   ├── clients/
│   │   │   │   └── page.tsx     # NEW
│   │   │   ├── investigators/
│   │   │   │   └── page.tsx     # NEW
│   │   │   └── [existing pages verified]
│   │   └── settings/
│   │       ├── page.tsx         # NEW: Settings hub
│   │       ├── profile/
│   │       │   └── page.tsx     # NEW
│   │       └── notifications/
│   │           └── page.tsx     # NEW
│   ├── components/
│   │   ├── lawyer/
│   │   │   ├── ClientCard.tsx   # NEW
│   │   │   ├── ClientTable.tsx  # NEW
│   │   │   ├── InvestigatorCard.tsx # NEW
│   │   │   └── InvestigatorTable.tsx # NEW
│   │   └── settings/
│   │       ├── ProfileForm.tsx  # NEW
│   │       └── NotificationSettings.tsx # NEW
│   ├── hooks/
│   │   ├── useClients.ts        # NEW
│   │   ├── useInvestigators.ts  # NEW
│   │   └── useSettings.ts       # NEW
│   ├── lib/api/
│   │   ├── clients.ts           # NEW
│   │   ├── investigators.ts     # NEW
│   │   └── settings.ts          # NEW
│   └── types/
│       ├── client.ts            # NEW
│       ├── investigator.ts      # NEW
│       └── settings.ts          # NEW
└── src/__tests__/
    ├── app/lawyer/clients/page.test.tsx     # NEW
    ├── app/lawyer/investigators/page.test.tsx # NEW
    ├── app/settings/page.test.tsx           # NEW
    └── hooks/
        ├── useClients.test.ts   # NEW
        └── useInvestigators.test.ts # NEW
```

**Structure Decision**: Web application structure following existing CHAGOK patterns. Backend uses Clean Architecture (Routers → Services → Repositories). Frontend uses Next.js App Router with hooks pattern.

## Implementation Phases

### Phase 1: Fix Blocking Issues (US1 - P1)

1. Fix merge conflict in `backend/app/api/lawyer_portal.py`
2. Verify existing pages build/deploy correctly:
   - `/lawyer/cases` - has `page.tsx`
   - `/lawyer/calendar` - has `page.tsx`
   - `/lawyer/messages` - has `page.tsx`
   - `/lawyer/billing` - has `page.tsx`

### Phase 2: Client Management (US2 - P2)

1. Backend:
   - Create `ClientFilter`, `ClientListResponse` schemas
   - Create `ClientListService` with query logic
   - Create `GET /lawyer/clients` and `GET /lawyer/clients/{id}` endpoints
   - Write tests (TDD)

2. Frontend:
   - Create `ClientItem` type
   - Create `useClients` hook with mock fallback
   - Create `ClientTable` and `ClientCard` components
   - Create `/lawyer/clients/page.tsx`
   - Write component tests (TDD)

### Phase 3: Investigator Management (US3 - P2)

1. Backend (same pattern as clients):
   - Schemas, Service, API endpoints
   - Tests

2. Frontend (same pattern as clients):
   - Types, hooks, components, page
   - Tests

### Phase 4: Settings Page (US4 - P3)

1. Backend:
   - Settings schemas
   - Settings service (may use existing user repository)
   - Profile and notification endpoints
   - Tests

2. Frontend:
   - Settings hub page with navigation
   - Profile form component
   - Notification settings component
   - Tests

### Phase 5: Cases Redirect (US5 - P3)

- Already implemented in middleware (lines 191-194)
- Verify functionality with different user roles
- Add test coverage

## Complexity Tracking

No violations requiring justification. Feature follows existing patterns without adding complexity.

## Dependencies

- Existing `users`, `cases`, `case_members` tables
- Existing `CaseRepository` and `UserRepository`
- Existing lawyer portal layout (`/lawyer/layout.tsx`)
- Existing design system tokens (CSS variables)

## Risks

1. **Merge conflict in lawyer_portal.py**: Must be resolved before any backend work
2. **Empty directories**: May cause build issues - verify clean build works
3. **Mock data dependency**: Frontend may work locally but fail with real API

## Next Steps

Run `/speckit.tasks` to generate detailed task list from this plan.
