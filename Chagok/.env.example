# ==============================================================================
# CHAGOK - Unified Environment Variables Template
# ==============================================================================
#
# IMPORTANT: This is a unified .env file for all services.
# Copy this file to .env and fill in your values.
#
# Symlinks in each service directory point to this root .env:
#   - backend/.env    -> ../.env
#   - ai_worker/.env  -> ../.env
#   - frontend/.env   -> ../.env
#
# NEVER commit .env files with real credentials to Git.
#
# ==============================================================================


# ==============================================================================
# SHARED CONFIGURATION
# ==============================================================================

# ── AWS Configuration ──
AWS_REGION=ap-northeast-2
AWS_ACCESS_KEY_ID=YOUR_AWS_ACCESS_KEY_ID
AWS_SECRET_ACCESS_KEY=YOUR_AWS_SECRET_ACCESS_KEY

# ── S3 Evidence Storage ──
S3_EVIDENCE_BUCKET=leh-evidence-dev
S3_EVIDENCE_PREFIX=cases/
S3_PRESIGNED_URL_EXPIRE_SECONDS=3600
S3_DOWNLOAD_TMP_PATH=/tmp

# ── DynamoDB Evidence Metadata ──
# STANDARD (use these):
DDB_EVIDENCE_TABLE=leh_evidence_dev
DDB_CASE_SUMMARY_TABLE=leh_case_summary_dev
# Legacy aliases (AI Worker fallback):
DYNAMODB_TABLE=leh_evidence_dev
DYNAMODB_TABLE_CASE_SUMMARY=leh_case_summary_dev

# ── Qdrant Vector Store ──
QDRANT_HOST=localhost
QDRANT_PORT=6333
QDRANT_API_KEY=
QDRANT_URL=http://localhost:6333
# NOTE: Backend uses QDRANT_CASE_INDEX_PREFIX, AI Worker uses QDRANT_COLLECTION_PREFIX
QDRANT_CASE_INDEX_PREFIX=case_rag_
QDRANT_COLLECTION_PREFIX=case_rag_
QDRANT_COLLECTION=leh_evidence
QDRANT_VECTOR_SIZE=1536
QDRANT_DEFAULT_TOP_K=5

# ── OpenAI API ──
OPENAI_API_KEY=sk-your-openai-api-key
OPENAI_API_BASE=https://api.openai.com/v1
# Backend model names
OPENAI_MODEL_CHAT=gpt-4o-mini
OPENAI_MODEL_EMBEDDING=text-embedding-3-small
# AI Worker model names
OPENAI_GPT_MODEL=gpt-4o-mini
OPENAI_WHISPER_MODEL=whisper-1
OPENAI_VISION_MODEL=gpt-4o-mini
OPENAI_EMBEDDING_MODEL=text-embedding-3-small
LLM_REQUEST_TIMEOUT_SECONDS=60

# ── Feature Flags (Shared) ──
FEATURE_DRAFT_PREVIEW_ONLY=true
FEATURE_ENABLE_RAG_SEARCH=true
FEATURE_ENABLE_TIMELINE_VIEW=true
FEATURE_ENABLE_EXPORT_DOCX=true

# ── Logging & Observability ──
LOG_LEVEL=INFO                              # DEBUG | INFO | WARNING | ERROR
LOG_FORMAT=text                             # text for local, json for prod
ENABLE_METRICS=true                         # Enable metrics collection

# ── External API Keys ──
LAW_API_MEMBER_ID=                          # 국가법령정보센터 API Member ID (Optional)


# ==============================================================================
# BACKEND (FastAPI)
# ==============================================================================

# ── Application ──
APP_NAME=chagok
APP_ENV=local                               # local | dev | prod
APP_DEBUG=true                              # false in production

BACKEND_HOST=0.0.0.0
BACKEND_PORT=8000
BACKEND_LOG_LEVEL=INFO
API_BASE_URL=http://localhost:8000

# ── CORS ──
CORS_ALLOW_ORIGINS=https://chagok.example.com,http://localhost:3000,http://127.0.0.1:3000
BACKEND_CORS_ORIGINS=http://localhost:3000

# ── AWS Secrets Manager (Optional) ──
# In dev/prod, secrets are loaded from AWS Secrets Manager.
# Environment variables take precedence over Secrets Manager values.
# Secret Name: chagok/secrets
# Structure: {"JWT_SECRET": "...", "OPENAI_API_KEY": "...", "DATABASE_URL": "..."}
AWS_SECRETS_MANAGER_ENABLED=false           # Set to true in dev/prod to use Secrets Manager

# ── Authentication / JWT ──
# NOTE: In dev/prod, JWT_SECRET can be stored in AWS Secrets Manager
JWT_SECRET=CHANGE_ME_MIN_32_CHARS_RANDOM_STRING
JWT_ALGORITHM=HS256
JWT_ACCESS_TOKEN_EXPIRE_MINUTES=60          # 1440 (24h) for local dev
JWT_REFRESH_TOKEN_EXPIRE_DAYS=7

# ── Cookie Settings (Cross-Origin Auth) ──
# IMPORTANT: For CloudFront + separate API domain, you need:
#   - COOKIE_SECURE=true (HTTPS required)
#   - COOKIE_SAMESITE=none (cross-origin cookies)
#   - CORS origins must include CloudFront domain
COOKIE_SECURE=false                         # true in production (HTTPS)
COOKIE_SAMESITE=lax                         # lax for local, none for cross-origin prod
COOKIE_DOMAIN=                              # empty = current domain (recommended)

# ── Admin Default Account ──
ADMIN_DEFAULT_EMAIL=admin@example.com
ADMIN_DEFAULT_PASSWORD=CHANGE_ME_STRONG_PASSWORD

# ── Database ──
# SQLite for local development
DATABASE_URL=sqlite:///./leh_local.db
# PostgreSQL for production (uncomment and configure)
# POSTGRES_HOST=<your-rds-endpoint>.rds.amazonaws.com
# POSTGRES_PORT=5432
# POSTGRES_USER=leh_user
# POSTGRES_PASSWORD=CHANGE_ME
# POSTGRES_DB=leh_db
# DATABASE_URL=postgresql+psycopg2://leh_user:CHANGE_ME@<host>:5432/leh_db

# ── Sentry (Optional) ──
# SENTRY_DSN=https://xxx@sentry.io/xxx
# SENTRY_TRACES_SAMPLE_RATE=0.1


# ==============================================================================
# AI WORKER (Lambda)
# ==============================================================================

# ── Environment ──
ENVIRONMENT=dev                             # dev | staging | prod

# ── Parser Settings ──
MAX_FILE_SIZE_MB=100
ENABLE_IMAGE_VISION=true
ENABLE_IMAGE_OCR=false

# ── Analysis Settings ──
ENABLE_ARTICLE_840_TAGGING=true
ENABLE_EVIDENCE_SUMMARIZATION=true
ENABLE_RISK_ANALYSIS=false

# ── Vector Store Settings ──
VECTOR_DIMENSION=1536
SIMILARITY_THRESHOLD=0.7

# ── CloudWatch (Lambda) ──
ENABLE_CLOUDWATCH_LOGS=true

# ── Redis (Optional, for caching) ──
# REDIS_HOST=your-redis-endpoint
# REDIS_PORT=6379
# REDIS_DB=0

# ── Testing ──
PYTEST_MOCK_S3=true
PYTEST_MOCK_QDRANT=true


# ==============================================================================
# FRONTEND (Next.js)
# ==============================================================================
# Note: Client-side variables MUST start with NEXT_PUBLIC_

NEXT_PUBLIC_API_BASE_URL=http://localhost:8000
NEXT_PUBLIC_APP_ENV=local                   # local | dev | production
NEXT_PUBLIC_APP_BASE_URL=http://localhost:3000
NEXT_PUBLIC_SITE_URL=http://localhost:3000  # Backwards compatibility (layout.tsx fallback)

# ── Feature Flags (Frontend) ──
NEXT_PUBLIC_FEATURE_DRAFT_PREVIEW_ONLY=true
NEXT_PUBLIC_FEATURE_ENABLE_RAG_SEARCH=true
NEXT_PUBLIC_FEATURE_ENABLE_TIMELINE_VIEW=true
NEXT_PUBLIC_FEATURE_ENABLE_EXPORT_DOCX=true

# ── Analytics (Optional) ──
# NEXT_PUBLIC_SENTRY_DSN=https://xxx@sentry.io/xxx
# NEXT_PUBLIC_SENTRY_TRACES_SAMPLE_RATE=0.1
# NEXT_PUBLIC_GA_MEASUREMENT_ID=G-XXXXXXXXXX

# ── CDN (Production) ──
# NEXT_PUBLIC_CDN_URL=https://d123456.cloudfront.net

# ── Playwright E2E Testing ──
PLAYWRIGHT_BASE_URL=http://localhost:3000   # Base URL for Playwright tests


# ==============================================================================
# LEGAL NOTICES
# ==============================================================================
LEGAL_NOTICE_URL=https://chagok.example.com/legal-notice
PRIVACY_POLICY_URL=https://chagok.example.com/privacy
TERMS_OF_SERVICE_URL=https://chagok.example.com/terms
AI_OUTPUT_DISCLAIMER="AI가 생성한 문서는 초안이며, 반드시 법률 전문가의 검토가 필요합니다."


# ==============================================================================
# CI/CD (GitHub Secrets) - NOT in .env files
# ==============================================================================
# These are set in GitHub repository settings > Secrets:
#
# AWS_ROLE_ARN              - IAM Role ARN for OIDC authentication
# S3_FRONTEND_BUCKET        - S3 bucket for frontend static hosting
# CLOUDFRONT_DISTRIBUTION_ID - CloudFront distribution ID
# BACKEND_API_URL           - Production backend API URL
